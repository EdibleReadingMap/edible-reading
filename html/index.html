<!DOCTYPE html>
<html>
  <head>
    <!-- prevent iPhone user from using browser zoom -->
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Edible Reading Map</title>
    <style>
      html, body, #map-canvas {
        height: 100%;
        margin: 0px;
        padding: 0px;
      }
      .balloon {
        position: relative;
      }
      .balloon #arrow {
        width: 0;
        height: 0;
        display: block;
        border-width: 15px 6px 0px 6px;
        border-color: azure transparent transparent transparent;
        border-style: solid;
        opacity: 0.95;
        position: absolute;
        left: 0px;
      }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?sensor=true&v=3.exp"></script>
    <script src="https://rawgit.com/googlemaps/v3-utility-library/master/infobox/src/infobox_packed.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script>

var lat = 51.4542
   ,lng = -0.9731;

function success(position) {
  var latmin = 51.411168
     ,latmax = 51.539263
     ,lngmin = -1.136984
     ,lngmax = -0.7519424
     ,mylat  = position.coords.latitude
     ,mylng  = position.coords.longitude;

  if (mylat > latmin && mylat < latmax) {
    lat = mylat;
  }
  if (mylng > lngmin && mylng < lngmax) {
    lng = mylng;
  }
}

function initialize() {
  // FIXME
  // navigator.geolocation.getCurrentPosition(success);

  var reading = new google.maps.LatLng(lat, lng);
  var mapOptions = {
    zoom: 15
   ,center: reading
   ,mapTypeId: google.maps.MapTypeId.ROADMAP
  }

  var edread = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
  var kmllayer = new google.maps.KmlLayer({
    url: 'https://raw.githubusercontent.com/ollyg/edible-reading/1.8/html/edread.kml'
   ,preserveViewport: true // preserve our mapOptions center
   ,suppressInfoWindows: true
   ,map: edread
  });

  var infobox = new InfoBox({
    boxStyle: {
      background: 'azure'
     ,opacity: 0.90
     ,'white-space': 'nowrap'
     ,margin: '3px 3px 0px -10px'
     ,padding: '3px 15px 3px 3px'
     ,borderRadius: '5px'
    }
   ,closeBoxMargin: '1px -11px 3px 3px'
   ,alignBottom: true
   ,infoBoxClearance: new google.maps.Size(1, 1)
  });

  google.maps.event.addListener(kmllayer, 'click', function(kmlEvent) {
    var content = document.createElement('div');
    var contentjq = $(content);

    infobox.close();
    infobox.setOptions({
      pixelOffset: kmlEvent.pixelOffset
     ,position: kmlEvent.latLng
     ,content: content
    });

    contentjq.addClass('balloon')
             .html(kmlEvent.featureData.infoWindowHtml + '<div id="arrow"></div>');
    infobox.open(edread);
  });
}

google.maps.event.addDomListener(window, 'load', initialize);

    </script>
  </head>
  <body>
    <div id="map-canvas"></div>
  </body>
</html>

<!--
lat: 51.411168 <-> 51.539263
long: -1.136984 <-> -0.7519424
midlat: 51.4752155, mindlong: -0.9444632
reading lat: 51.4542, long: -0.9731
-->
